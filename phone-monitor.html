<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Phone Monitor</title>
		<style>
			body { font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin: 24px; }
			.card { border: 1px solid #ddd; border-radius: 8px; padding: 16px; max-width: 800px; }
			pre { background:#f6f8fa; padding:12px; border-radius:6px; overflow:auto }
			.meta { color:#666; font-size:0.9rem; margin-top:8px }
			button { margin-right:8px }
		</style>
	</head>
	<body>
		<h1>Phone Monitor</h1>
		<div class="card">
			<div>
				<button id="refreshBtn">Refresh now</button>
				<label><input type="checkbox" id="autoRefresh" checked /> Auto-refresh (2s)</label>
			</div>

			<div class="meta" id="meta">Last checked: never</div>
			<h3>Latest status (JSON)</h3>
			<pre id="status">{ "status": "unknown" }</pre>
		</div>

		<script>
			const statusEl = document.getElementById('status');
			const metaEl = document.getElementById('meta');
			const refreshBtn = document.getElementById('refreshBtn');
			const autoRefresh = document.getElementById('autoRefresh');

			async function fetchStatus() {
				try {
					const res = await fetch('/api/phone/status', { cache: 'no-store' });
					if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
					const json = await res.json();
					statusEl.textContent = JSON.stringify(json, null, 2);
					metaEl.textContent = 'Last checked: ' + new Date().toLocaleString();
				} catch (err) {
					statusEl.textContent = '{ "error": "' + String(err) + '" }';
					metaEl.textContent = 'Last checked: ' + new Date().toLocaleString();
				}
			}

			refreshBtn.addEventListener('click', fetchStatus);

			// auto refresh loop
			let timer = null;
			function startLoop() {
				if (timer) clearInterval(timer);
				timer = setInterval(() => { if (autoRefresh.checked) fetchStatus(); }, 2000);
			}

			autoRefresh.addEventListener('change', () => { if (autoRefresh.checked) fetchStatus(); });

			// initial run
			fetchStatus();
			startLoop();
		</script>
	</body>
</html>
